# N1 Switch Parser Test - Multi-case flattening

# Node type constants
var NODE_SWITCH = 21
var NODE_CASE = 22

# CaseClause with multi-value support
struktur CaseClause
    node_type int
    values_count int
    v0 int
    v1 int
    v2 int
akhir

fungsi make_case(line int) CaseClause
    kembalikan CaseClause{node_type: NODE_CASE, values_count: 0, v0: 0, v1: 0, v2: 0}
akhir

fungsi case_add(c CaseClause, val int) CaseClause
    jika c.values_count == 0
        c.v0 = val
    akhir
    jika c.values_count == 1
        c.v1 = val
    akhir
    jika c.values_count == 2
        c.v2 = val
    akhir
    c.values_count = c.values_count + 1
    kembalikan c
akhir

fungsi case_match(c CaseClause, val int) bool
    jika c.values_count >= 1
        jika c.v0 == val
            kembalikan benar
        akhir
    akhir
    jika c.values_count >= 2
        jika c.v1 == val
            kembalikan benar
        akhir
    akhir
    jika c.values_count >= 3
        jika c.v2 == val
            kembalikan benar
        akhir
    akhir
    kembalikan salah
akhir

# SwitchStatement
struktur SwitchStatement
    node_type int
    cases_count int
    c0 CaseClause
    c1 CaseClause
    has_default bool
akhir

fungsi make_switch() SwitchStatement
    var empty = make_case(0)
    kembalikan SwitchStatement{node_type: NODE_SWITCH, cases_count: 0, c0: empty, c1: empty, has_default: salah}
akhir

fungsi switch_add(sw SwitchStatement, c CaseClause) SwitchStatement
    jika sw.cases_count == 0
        sw.c0 = c
    lainnya
        sw.c1 = c
    akhir
    sw.cases_count = sw.cases_count + 1
    kembalikan sw
akhir

# Flattened switch evaluation (like if-else chain)
fungsi switch_eval(sw SwitchStatement, val int) int
    # Returns: 0=case0, 1=case1, -1=default, -2=no match
    jika sw.cases_count >= 1
        jika case_match(sw.c0, val)
            kembalikan 0
        akhir
    akhir
    jika sw.cases_count >= 2
        jika case_match(sw.c1, val)
            kembalikan 1
        akhir
    akhir
    jika sw.has_default
        kembalikan -1
    akhir
    kembalikan -2
akhir

# Test
fungsi main() void
    native_print("N1 Switch Multi-Case Test\n")
    native_print("=========================\n\n")
    
    # Build switch statement:
    # pilih x
    #   kasus 1, 2, 3:    -> case 0 (multi-value!)
    #   kasus 10:         -> case 1
    #   lainnya:          -> default
    # akhir
    
    var sw = make_switch()
    
    # Case 0: kasus 1, 2, 3
    var c0 = make_case(1)
    c0 = case_add(c0, 1)
    c0 = case_add(c0, 2)
    c0 = case_add(c0, 3)
    sw = switch_add(sw, c0)
    
    # Case 1: kasus 10
    var c1 = make_case(2)
    c1 = case_add(c1, 10)
    sw = switch_add(sw, c1)
    
    sw.has_default = benar
    
    # Test multi-case matching
    native_print("Multi-case test (kasus 1, 2, 3):\n")
    
    jika switch_eval(sw, 1) == 0
        native_print("✓ val=1 matches case 0\n")
    lainnya
        native_print("✗ val=1 should match case 0\n")
    akhir
    
    jika switch_eval(sw, 2) == 0
        native_print("✓ val=2 matches case 0\n")
    lainnya
        native_print("✗ val=2 should match case 0\n")
    akhir
    
    jika switch_eval(sw, 3) == 0
        native_print("✓ val=3 matches case 0\n")
    lainnya
        native_print("✗ val=3 should match case 0\n")
    akhir
    
    # Test single case
    native_print("\nSingle case test (kasus 10):\n")
    
    jika switch_eval(sw, 10) == 1
        native_print("✓ val=10 matches case 1\n")
    lainnya
        native_print("✗ val=10 should match case 1\n")
    akhir
    
    # Test default
    native_print("\nDefault test:\n")
    
    jika switch_eval(sw, 99) == -1
        native_print("✓ val=99 goes to default\n")
    lainnya
        native_print("✗ val=99 should go to default\n")
    akhir
    
    native_print("\nSwitch Multi-Case OK!\n")
akhir
