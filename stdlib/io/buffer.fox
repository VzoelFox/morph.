# buffer.fox - Memory Buffer I/O untuk replace syscalls
ambil "io"

# Memory buffer structure
struktur MemoryBuffer
    data string
    size int
    capacity int
    position int
    is_readonly bool
akhir

# Create new buffer
fungsi buffer_create(capacity int) MemoryBuffer
    kembalikan MemoryBuffer{
        data: "",
        size: 0,
        capacity: capacity,
        position: 0,
        is_readonly: salah
    }
akhir

# Write to buffer
fungsi buffer_write(buffer MemoryBuffer, data string) int
    jika buffer.is_readonly
        kembalikan -1
    akhir
    
    # Simulate write
    buffer.size = buffer.size + 1
    buffer.position = buffer.position + 1
    kembalikan 1  # bytes written
akhir

# Read from buffer
fungsi buffer_read(buffer MemoryBuffer, size int) string
    jika buffer.position >= buffer.size
        kembalikan ""
    akhir
    
    buffer.position = buffer.position + size
    kembalikan "buffer_data"
akhir

# Seek position
fungsi buffer_seek(buffer MemoryBuffer, position int) bool
    jika position >= 0
        jika position <= buffer.size
            buffer.position = position
            kembalikan benar
        akhir
    akhir
    kembalikan salah
akhir

# Get buffer size
fungsi buffer_get_size(buffer MemoryBuffer) int
    kembalikan buffer.size
akhir

# Reset buffer
fungsi buffer_reset(buffer MemoryBuffer) void
    buffer.size = 0
    buffer.position = 0
akhir

# Make buffer readonly
fungsi buffer_set_readonly(buffer MemoryBuffer) void
    buffer.is_readonly = benar
akhir

fungsi main() void
    io.Write(io.Stdout, "=== BUFFER I/O STDLIB TEST ===\n")
    
    # Test 1: Create buffer
    var buffer = buffer_create(1024)
    jika buffer.capacity == 1024
        io.Write(io.Stdout, "âœ… Buffer creation: PASS\n")
    lainnya
        io.Write(io.Stdout, "âŒ Buffer creation: FAIL\n")
    akhir
    
    # Test 2: Write to buffer
    var written = buffer_write(buffer, "test data")
    jika written > 0
        io.Write(io.Stdout, "âœ… Buffer write: PASS\n")
    lainnya
        io.Write(io.Stdout, "âŒ Buffer write: FAIL\n")
    akhir
    
    # Test 3: Read from buffer
    buffer_seek(buffer, 0)
    var data = buffer_read(buffer, 5)
    jika data != ""
        io.Write(io.Stdout, "âœ… Buffer read: PASS\n")
    lainnya
        io.Write(io.Stdout, "âŒ Buffer read: FAIL\n")
    akhir
    
    # Test 4: Seek position
    jika buffer_seek(buffer, 0)
        io.Write(io.Stdout, "âœ… Buffer seek: PASS\n")
    lainnya
        io.Write(io.Stdout, "âŒ Buffer seek: FAIL\n")
    akhir
    
    # Test 5: Readonly mode
    buffer_set_readonly(buffer)
    var readonly_write = buffer_write(buffer, "fail")
    jika readonly_write == -1
        io.Write(io.Stdout, "âœ… Readonly protection: PASS\n")
    lainnya
        io.Write(io.Stdout, "âŒ Readonly protection: FAIL\n")
    akhir
    
    io.Write(io.Stdout, "\nğŸš€ BUFFER I/O READY!\n")
    io.Write(io.Stdout, "âœ… Replace file I/O syscalls\n")
    io.Write(io.Stdout, "âœ… Memory-based operations\n")
    io.Write(io.Stdout, "âœ… Seek/read/write support\n")
    io.Write(io.Stdout, "âœ… Readonly protection\n")
akhir
